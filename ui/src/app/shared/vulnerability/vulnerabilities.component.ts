import {Component, Input} from '@angular/core';
import {Severity, Vulnerability} from '../../model/application.model';

@Component({
    selector: 'app-vulnerabilities',
    templateUrl: './vulnerabilities.html',
    styleUrls: ['./vulnerabilities.scss']
})
export class VulnerabilitiesComponent {

    _vulnerabilities: Array<Vulnerability>;
    summary = {
        total: 0,
        defcon: 0,
        critical: 0,
        high: 0,
        medium: 0,
        low: 0,
        negligible: 0,
        unknown: 0
    };
    @Input('vulnerabilities')
    set vulnerabilities(data: Array<Vulnerability>) {
        if (data) {
            let defcon1 = data.filter(v => v.severity === Severity.DEFCON1 );
            let critical = data.filter(v => v.severity === Severity.CRITICAL );
            let high = data.filter(v => v.severity === Severity.HIGH );
            let medium = data.filter(v => v.severity === Severity.MEDIUM );
            let low = data.filter(v => v.severity === Severity.LOW );
            let negligible = data.filter(v => v.severity === Severity.NEGLIGIBLE );
            let unknown = data.filter(v => v.severity === Severity.UNKNOWN );
            this.summary.critical = critical.length;
            this.summary.defcon = defcon1.length;
            this.summary.high = high.length;
            this.summary.low = low.length;
            this.summary.medium = medium.length;
            this.summary.negligible = negligible.length;
            this.summary.unknown = unknown.length;
            this.summary.total = this.summary.critical + this.summary.defcon + this.summary.high + this.summary.medium
             + this.summary.low + this.summary.negligible + this.summary.unknown;
            this._vulnerabilities = defcon1.concat(critical, high, medium, low, negligible, unknown);
        }
    }

    get vulnerabilities() {
        return this._vulnerabilities;
    }
}
